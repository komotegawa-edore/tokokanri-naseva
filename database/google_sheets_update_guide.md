# Google Sheetsのヘッダー更新手順

初回登録機能を追加したため、スプレッドシートのヘッダー行を更新する必要があります。

## 更新が必要な理由

フルネームと学年の情報を記録するため、スプレッドシートの列が増えました。

### 旧フォーマット（7列）
```
A: 登校時刻
B: LINE表示名
C: LINE ID
D: 教室
E: 座席番号
F: 下校時刻
G: 滞在時間（分）
```

### 新フォーマット（9列）
```
A: 登校時刻
B: LINE表示名
C: フルネーム
D: 学年
E: LINE ID
F: 教室
G: 座席番号
H: 下校時刻
I: 滞在時間（分）
```

## 更新手順

### 方法1: 既存のデータを残したまま更新（推奨）

1. Google Sheetsを開く

2. **C列とD列を新規挿入**
   - C列のヘッダー（現在の「LINE ID」）を右クリック
   - 「2列を左に挿入」を選択

3. **新しいヘッダーを入力**
   - C1セルに「フルネーム」と入力
   - D1セルに「学年」と入力

4. **既存データの確認**
   - 既存のデータは自動的に右にシフトされます
   - E列: LINE ID
   - F列: 教室
   - G列: 座席番号
   - H列: 下校時刻
   - I列: 滞在時間（分）

5. **動作確認**
   - アプリで新規登録して、データが正しく記録されるか確認

### 方法2: 新しいシートで開始（データリセット）

1. Google Sheetsを開く

2. **新しいシートを作成**
   - 下部の「+」ボタンをクリック
   - シート名を「登校記録」に設定

3. **ヘッダー行を入力**
   ```
   A1: 登校時刻
   B1: LINE表示名
   C1: フルネーム
   D1: 学年
   E1: LINE ID
   F1: 教室
   G1: 座席番号
   H1: 下校時刻
   I1: 滞在時間（分）
   ```

4. **環境変数を更新**
   - `.env`ファイルの`ATTENDANCE_SHEET_NAME`を新しいシート名に変更
   - Vercelの環境変数も同様に更新

5. **アプリを再起動**
   ```bash
   npm run dev
   ```

## 既存ユーザーの対応

既存のユーザーは初回登録フローをスキップしているため、フルネームと学年が空欄になります。

### 既存ユーザーのデータを手動で追加する場合

1. Supabaseダッシュボードを開く

2. `users`テーブルを開く

3. 各ユーザーの行を編集
   - `full_name`: フルネームを入力
   - `grade`: 学年を入力（中学生/高１/高２/高３/既卒生）
   - `registration_completed`: `true`に設定

4. 保存

### 既存ユーザーに再登録を促す場合

1. Supabaseダッシュボードで`users`テーブルを開く

2. 既存ユーザーの`registration_completed`を`false`に設定

3. 次回LINE Botを利用する際に、初回登録フローが表示されます

## トラブルシューティング

### エラー: "Invalid range"

- スプレッドシートのシート名が正しいか確認
- `.env`の`ATTENDANCE_SHEET_NAME`を確認

### データが記録されない

- ヘッダー行（1行目）が正しく設定されているか確認
- サービスアカウントにスプレッドシートの編集権限があるか確認

### 既存データが消えた

- Google Sheetsの「編集履歴」から復元可能
- ファイル > 変更履歴 > 変更履歴を表示
